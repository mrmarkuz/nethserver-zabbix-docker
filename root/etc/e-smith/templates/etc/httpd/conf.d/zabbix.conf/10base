#
# Zabbix monitoring system reverse proxy
#

<VirtualHost *:80>
    IncludeOptional conf.d/default-virtualhost.inc
</VirtualHost>

<VirtualHost *:443>
    ServerName { $zabbix-docker{VirtualHost} || "zabbix.".$DomainName }
    SSLEngine On
    ProxyPassMatch ^/.well-known/acme-challenge/ !
    ProxyPass  / http://localhost:{$zabbix-docker{'TCPPort'}}/ max=3 retry=30
    ProxyPassReverse / http://localhost:{$zabbix-docker{'TCPPort'}}/
    ProxyPreserveHost On
    <Location "/">
      <RequireAll>
        Require all granted
      </RequireAll>
    </Location>
</VirtualHost>

<VirtualHost *:80>
    ServerName { $zabbix-docker{VirtualHost} || "zabbix.".$DomainName }
    ProxyPassMatch ^/.well-known/acme-challenge/ !
    ProxyPass  / http://localhost:{$zabbix-docker{'TCPPort'}}/ max=3 retry=30
    ProxyPassReverse / http://localhost:{$zabbix-docker{'TCPPort'}}/
    ProxyPreserveHost On
    <Location "/">
      <RequireAll>
        Require all granted
      </RequireAll>
    </Location>
</VirtualHost>
